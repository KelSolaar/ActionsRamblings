name: OIIO

on: [push]

jobs:
  build:
    strategy:
      max-parallel: 4
      matrix:
        os: [ubuntu-18.04]
        python-version: [3.6]
    runs-on: ${{ matrix.os }}
    steps:
    - uses: actions/checkout@v1
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v1
      with:
        python-version: ${{ matrix.python-version }}
    - name: Ubuntu - Update OS & Install APT Dependencies
      if: matrix.os == 'ubuntu-18.04'    
      run: |
        sudo apt-get update
        sudo apt-get --yes install libboost-all-dev libilmbase-dev libopenexr-dev
    - name: Ubuntu - Download Conda
      env:
        PYTHON_VERSION: ${{ matrix.python-version }}
      if: matrix.os == 'ubuntu-18.04'    
      run: |
        if [ ${PYTHON_VERSION:O:1} == "2" ]; then wget http://repo.continuum.io/miniconda/Miniconda2-latest-Linux-x86_64.sh -O miniconda.sh; else wget http://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh; fi
    - name: macOS - Download Conda
      env:
        PYTHON_VERSION: ${{ matrix.python-version }}
      if: matrix.os == 'macOS-10.14'    
      run: |
        if [ ${PYTHON_VERSION:O:1} == "2" ]; then wget http://repo.continuum.io/miniconda/Miniconda2-latest-MacOSX-x86_64.sh -O miniconda.sh; else wget http://repo.continuum.io/miniconda/Miniconda3-latest-MacOSX-x86_64.sh -O miniconda.sh; fi
    - name: Install Package Dependencies
      env:
        PYTHON_VERSION: ${{ matrix.python-version }}
      run: |
        chmod +x miniconda.sh
        ./miniconda.sh -b -p $HOME/miniconda
        PATH=$HOME/miniconda/bin:$PATH
        echo ::set-env name=PATH::$PATH
        conda update --yes --quiet conda
        conda create --yes --quiet -n colour-ci python=${PYTHON_VERSION} coverage coveralls flake8 imageio matplotlib mock nose pandas pyqt scipy six
        source activate python-ci
    - name: Ubuntu - Install OIIO
      if: matrix.os == 'ubuntu-18.04' && matrix.python-version == '3.6'
      run: |
        wget https://github.com/colour-science/artifacts/suites/228982111/artifacts/37347 -O OpenImageIO-Release-1.8.17.zip
        unzip OpenImageIO-Release-1.8.17.zip
        pwd
        ll OpenImageIO-Release-1.8.17

